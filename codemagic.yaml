# Check out https://docs.codemagic.io/yaml/building-a-native-android-app/ for more information

workflows:
  android_qa:
    name: Run tests and build debug apk
    environment:
      vars:
        FIREBASE_JSON: Encrypted(Z0FBQUFBQmZteFFaT0NiYXVhcmttYVB1Snh2LVUwci1sNE1aNkwtazdTc0dOQlJieWYxSlZ2bGpoZ2Z5OTBfNHJWcFd5QmswNldqR24yUzhYQVdfVEN0LVo5R1QzZmJtRzdDQWVBNnNpRVJkWE9QcnBVNDZaa3RzZXlrbDZRWDROZHpwMGFodUJYaWZucHJQX29tZzk3bFNqTTBLeEROdFdqN3ptXzZLWHY1WndRYkdSamloOGhNSFZMUENreHFBdndBNzBUZjRGMERDWXJFNmNhSHRHZ3pZYks3dXZjaTF4YXlldnVaZEYweVYxUTdpQlk1Zi10Wkt5c2xuVGtJQzhrY3htTmhyVFJOU0lPcXJoZXVuUEVJOVdaUE1TdDhoa3pCTlExN2M0a3ZXQTFuS2NOa0E3ZTU1RkFaVm91UVlHbGdtdjZ5d2FZd0ltdkhkUm9ZdzhycTlUUkEzZWdKLWZJakRMR2VVLXpkUFdLUXdGM0FxMEY4RzhjczE2SXk3MXFEWXNMYnJFRHpLVEEwZ0ZPa29MUmhVLU42bjF0ekd0ZXNhbHBzSm44TzN4dWtsbUs4SjAxU2kyeXdEdlNvbElWWThaN3h4dF9lVVhCM0hiWDlJNUdwVHNidDZDOHREenhDMEM1SkhudGFiWlRpMXY3NkJrQzctOWNscUxFck82ZUNjZHFxaUFMVjZnUWpiNFZiMERQcE5ycnR6UnN2WkU5WkYxSUgxRzlGZklYNVlnU2xuVEtxdnJPWU1GMEFjWWVPbmQ4X3hIc1VKYjQzSzZjZmhXZGoyUVgzQk45NDRxQXNRUXJfN080TzBDNFVsc0IzZ05ESjRKS0lmQUFuZkw1dmxxYUp2WkFoVF9NZ1B3eU1sODFPdVBNcHJ5UmJfOFFya215cFVic2I2Q0JoZVU1Q3lZM29ubWZFZkhIVkRIdHMwQ2JhSHphWllPckdRM2tFZG54Vk5sQ2FGeUsyV3d3UkRZc20zdEpxLS1tLXZPem1tS0tvN1M2aGJuX25Ea29xaFF3V1FkemVzQUIzN0tHd0ZJYTBGeFUzTU56VEc0ZTYwczJrelBNamJ4NTFjb2IzQk5MNndaUXFYbk1Fc050SjNicDc3Uklza2V6anh0Z3FLSXc4czdpOXdCU01Nd190S1p0c0VOR1lzdXM0VXljMi1RampDeF9falBwTnV0VUhwby1ZVTNhUG9wRmN2dkVKR1l5RUxrejN3RHBzZUFMelZlTm1jODlhcFFnT0FrcG1VVW1fS2xWU1JRYnFHMHlXM0hfQzA0ZnFfZEQtS1VLREtiXzZGMTlvVW9VMkIzWFFjR09VeGpZd3phNExJN3h6ektUamRYVmFrbllKVjlZLURlR1k0bE5fdXhOcFJtVTZzY3hyb212OFFkVlRaUFVKZXp0ZjEyNXFMNGVGeW55cGM2enZzU3JHbjJRdXRVeWU5Q3hCSEZmSDNCa2YtTWc1cFJIcUotZ29xWklBQ28xdGFadW9hWG9jdW9EbzEyRlBJajEzT3JiWkNSOGJOcnBvaURXU2VucGF6WjQ2V0UzTmQyZmxmbzJyNTBla3pSalVBUk56T1M1YTVVcU9YZ3hDZlBhNWJta3d1LTBkanBSMF9Ea0hCT25MV3N1OURFSV9Jb2pZUC1kU1dacGNLSXlzM2RJU29lZEVfdG9zbkRZR3ZEWVNxQXd5U2JJTjVXTGdfNVU4TnlhNlRXZHRiLUNwN09tR3hrZGdqVTFjaFZ5clFLMTZLUFdzVlo0d1JnQ21wdHhmWFVpWWF3Tldpei0xWWZ4cmdwcHBLQmVZQW9MQjA0a2dieEhSb3E0dVdOTE8yMGdqWW1vczhfZlFxVXR3ZXUxcVVQYklHQ2E3VVBxZmxHN2ZVRHlLZHE2V1YwNFMtYjhpdGZaMnFZY3Y4OVNySXdzbDluWHBPX0o1Z3NsTEhEb0xTdDQ3VVc2MEJ3UEFjQ0dZdWNnSFk1UUhQQTNXYW44V2RFX19zdkp1dm9peFFfOUZNc1R1aVpGOGFBaFd0X2dXb0xLeFU4Q1QxdGh0M0pib3lES0tiVG9FN3AwTXZIOGFyVmt2SXoyYkpybWNONTFXRm5aSXdNbFFkVzk1QlNKLVRDM2M2ZjFtWUczQVFKaVV1U09nVnU2Mm5SNnh6MmJRRzNlMC13UWJRNW5CMk1hakdRUThRQWVPOEtldmtPTy1aa3ExSHlZQ2hVaEZOV09VejRkV2xuTDM3RkVaSUJLdjRLaHN3eFhvQmhVcFNpLTZRQXlzdFZwc21IY1JWUXpqTmZweDQyTDZ0OXU4ODBkdy1LSTRueHpvd2JCNmdyNC1remxiZ0p4aHpTYWFOWUdZNHdnby1Bb3ZXN0JYdmpuOFI0NTVOMFEzeDlYMzJ2b1pZM0s1Sjd2VUdHd2xwekpZWDZHbDhVQno2TkdUVGNKdW5xSTVYM2p0NlBwNjhzS3Bzbjc5WGtNNkFiTENDMFMzckhJZGplMlJmRXhYdVA3eFlYLUw5ZlBDRmRLV0M3VzBjb2VtUXFTVXRVNG1yQ2VmaXdVLXNnc1dFTlNTNlR6MnJoUzhDQ3pXMTh0WnY3bUxYZGNvdWtkZ3BYLWVCVGZRRFQzc0ZsNUxoRl9hSG9wRT0=)
    cache:
      cache_paths:
        - $HOME/.gradle/caches
    triggering:
      events:
        - push
      branch_patterns:
        - pattern: '*'
      cancel_previous_builds: true
    scripts:
      - echo $ANDROID_FIREBASE_CONFIG | base64 --decode > $FCI_BUILD_DIR/app/google-services.json
      - ./gradlew test
      - ./gradlew assembleDebug
      - firebase appdistribution:distribute $FCI_BUILD_OUTPUT_DIR/app-release-universal.apk --app 1:99999999999:android:8888888888888888888888 --groups "android-testers" --token "$FIREBASE_TOKEN"
    artifacts:
      - app/build/outputs/**/*.apk
